

- [1. 概要](#1-概要)
- [2. 目的・開発理由](#2-目的開発理由)
- [3. 前提条件](#3-前提条件)
  - [3.1. 対象](#31-対象)
    - [3.1.1. 検索サイト](#311-検索サイト)
    - [3.1.2. 都市](#312-都市)
      - [3.1.2.1. 愛知県](#3121-愛知県)
      - [3.1.2.2. 岐阜県](#3122-岐阜県)
    - [3.1.3. その他の条件](#313-その他の条件)
  - [3.2. Excelファイルの管理場所](#32-excelファイルの管理場所)
  - [3.3. 必要な情報](#33-必要な情報)
- [4. ツールの大まかな流れ (Typescript)](#4-ツールの大まかな流れ-typescript)
- [5. 各動作内の流れ](#5-各動作内の流れ)
  - [5.1. Puppeteerでサイト検索し、データスクレイピング](#51-puppeteerでサイト検索しデータスクレイピング)
  - [5.2. データをkintoneに格納](#52-データをkintoneに格納)
  - [5.3. KintoneからExcelデータを出力して整形](#53-kintoneからexcelデータを出力して整形)
- [6. 更新履歴](#6-更新履歴)

# ポータルチェック 要件定義 <!-- omit in toc -->
## 1. 概要

検索サイトで対象都市の物件を検索し、物件情報をExcelにまとめる
また、検索された物件情報がDO NETWORKで管理されているかどうか、またDO NETWORKでの登録情報も併せてExcelにまとめる

完成したExcelファイルをサーバへ移動する

## 2. 目的・開発理由
Uipathでのポータルチェックの実行率、実行時の成功率が悪いため、python化により改善を図る
また、現状PC4台に分けて実行しているが、PC１台に絞り保守メンテナンス性を向上させる

## 3. 前提条件

### 3.1. 対象
#### 3.1.1. 検索サイト
- [SUUMO](https://suumo.jp/tokai/)
- [HOMES](https://www.homes.co.jp/)
- [Yahoo](https://realestate.yahoo.co.jp/)
- [atHome](https://www.athome.co.jp/)
#### 3.1.2. 都市
##### 3.1.2.1. 愛知県
豊川市、豊橋市、蒲郡市、高浜市、碧南市、安城市、刈谷市、豊田市、西尾市、みよし市、名古屋市港区、名古屋市昭和区、名古屋市千種区、名古屋市中川区、名古屋市中村区、名古屋市熱田区
#####  3.1.2.2. 岐阜県
岐阜市
#### 3.1.3. その他の条件
3日以内に更新された物件
### 3.2. Excelファイルの管理場所

[\\192.168.11.150\Data01\★サポート共有\【ポータル新着物件】](file://192.168.11.150/Data01/★サポート共有/【ポータル新着物件】)

このフォルダ以下に、「【UiPath】yyyy.MM.dd新着物件情報」の命名規則でフォルダを準備し、そのフォルダ内に「〇〇市△△区_yyyy.MM.dd.xlsx」の命名規則でファイルを格納する

### 3.3. 必要な情報
1. 検索サイトから取り出す情報
		1.	物件名
		2.	販売価格
		3.	所在地
		4.	専有面積(マンション以外は土地面積)
		5.	物件情報へのリンク
		6.	掲載企業
		7.	掲載企業連絡先
2.	DO NETWORKから取り出す情報
		1.	管理有無
		2.	物件番号
		3.	ステータス
		4.	登録価格
		5.	価格差
		6.	検索結果件数
## 4. ツールの大まかな流れ (Typescript)
1.	Puppeteerでサイト検索し、データスクレイピング
2.	データをkintoneに格納
3.	kintoneからExcelにデータを出力して整形

## 5. 各動作内の流れ
### 5.1. Puppeteerでサイト検索し、データスクレイピング
1.	検索サイトで、県ごとに対象の都市すべてにチェックをいれ、条件を設定し検索する
2. 必要な情報をデータスクレイピングで取得する
3. 取得した情報をJSON形式に変換する
4. 変換した情報をCSVファイルに保存する
### 5.2. データをkintoneに格納
1. CSVファイルの情報とkintoneの登録情報を比較する(要検討)
2. 重複している物件情報は「kintone登録対象外」とする(要検討)
3. サーバ設定をする
4. CSVファイル内の対象物件のみをkintoneアプリに一括登録する
### 5.3. KintoneからExcelデータを出力して整形
1. kintoneにて、新規登録された物件情報が、DO NETWORKに登録済みかどうか等の情報を追加で登録する。この時、DO NETWORKの登録情報は、同期しているkintoneアプリから取得する
2. まとめた情報をExcelファイルに変換し、書式を整える
3. サーバにファイルを格納する

## 6. 更新履歴

- 1.1.0 (2022.05.18)
  - Markdownに変更
- 1.0.0 (2022.05.17)
  - 新規作成